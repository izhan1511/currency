import{u as m}from"./useAPI-d04b5e55.js";import{u as p}from"./notification-c7ee7316.js";import{_ as f}from"./Spinner-dd5ccd9b.js";import{e as v,c as _,b as r,n as g,j as w,t as y,u as i,f as S,g as h,O as n,o as c}from"./app-2cac3384.js";const x={class:"resend-code-wrapper"},I={class:"time"},C={name:"ResendEmailCode"},N=Object.assign(C,{setup(k){const t=m(),a=p(),e=v(parseInt(window.sessionStorage.getItem("resend-timer"))??60),l=async()=>{if(!(e.value>0)){t.startRequest();try{const s=await axios.post("/api/resend-email-code");s.data.status==="success"?(d(),a.notify("Email Sent.","success")):s.data.status==="redirect"?(a.notify("Session has expired!","error"),setTimeout(()=>{n.get("/user-info")},1e3)):a.notify("Unexpected error happened","error")}catch(s){let o="Invalid code";s.response.status===419&&(n.get("/user-info",{message:"session expired"},{preserveState:!1}),o="Session expired, please reload the page",setTimeout(()=>{window.location="/user-info"},1e3)),t.handleErrors(s),a.notify(o,"error")}finally{t.requestCompleted()}}},d=()=>{e.value=60,window.sessionStorage.setItem("resend-timer",e.value)},u=setInterval(()=>{e.value--,window.sessionStorage.setItem("resend-timer",e.value),e.value===0&&clearInterval(u)},1e3);return(s,o)=>(c(),_("div",x,[r("button",{class:g({"opacity-50 hover:cursor-not-allowed":e.value>0}),onClick:l}," Resend ",2),r("div",I,[w(y(e.value>0?"code in "+e.value:"")+" ",1),i(t).isLoading.value?(c(),S(f,{key:0,class:"ml-2",isLoading:i(t).isLoading.value},null,8,["isLoading"])):h("",!0)])]))}});export{N as default};
